# webpack
[webpack](./img/base.png)
> webpack 是一个前端打包工具，能够分析我们的项目结构，找到 JavaScript 模块和浏览器不能直接运行的扩展语言，打包成浏览器可以直接使用的格式。webpack 由 node 编写
* 代码转换，比如将es6代码转成es5
* 文件优化，可以压缩代码的体积合并文件
* 代码分割，多页面的模块分离，路由懒加载等
* 模块合并
* 自动刷新，可以开一一个本地服务
* 代码校验
* 自动发布，项目完成后可以实现自动发布
> webpack 将我们的模块(js文件) 差分成一个对象。通过入口来运行代码

## webpack.config.js 配置
> webpack 可以0配置，但是配置很弱，需要我们手动配置。webpack.config.js 就是 webpack的配置文件。
### 1. entry
* `entry`：要打包文件的入口(路径)
``` js
entry: './src/index.js', // 打包的出口文件
```

### 2. output
* `output`：打包好后的文件出口，可以定义文件名 `filename`，`path` 打包后文件存放的位置路径，这个路径必须是一个绝对路径，可以使用 `path.resolve(__dirname, 'dist')` 在当前目录下产生一个`dist`目录。
``` js
output: {
    filename: 'bundle[hash:8].js', // 打包后的文件名
    path: path.resolve(__dirname, 'dist') // 打包后文件夹存放的位置。
},
```

### 3.mode
* `mode`: 模式，打包后的环境可以是 `production`，`development`，`production` 环境下的代码会被压缩。
``` js
mode: 'development', // 打包的模式 开发环境和生产环境production
```

### 4. devServer
* `devServer:` 配置 `webpack-dev-server` 提供的本地服务信息
``` js
devServer: {
    port: 3000, // 打开后的端口号
    progress: true, // 打包过程中的进度条
    contentBase: './dist' // 打包后运行的文件夹
},
```

### 5. plugins
* `plugins`: 数组。用于存放安装的第三方插件。
``` js
const HtmlWebpackPlugin = require('html-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

// plugin: 存放webpack的第三方插件
plugins: [
    // 包后的js文件，通过script导入 html 文件内
    new HtmlWebpackPlugin({
        template: './src/index.html', // template: 打包后放入的模板
        filename: 'index.html', // 这是模板打包后的文件名
        minify: {
            removeAttributeQuotes: true, // 将 html 文件中的双引号去除
            collapseWhitespace: true, // 将html文件的代码转换成一行。
        },
        hash: true, // 哈希戳，可以保证缓存的不同
    }),

    //  抽离出来的 css
    new MiniCssExtractPlugin({
        filename: 'main.css', // 抽离出来的 css 文件名是 main.js
    })
],
```

### 6.modules
* `modules`: 配置模块的 `loader` 用于将模块 `require()` 导入到打包的文件。属性 `rules 数组` 可以定义模块的 `loader`
* `test` 是正则表达式，用于匹配文件的后缀名
* `use` 可以是一个数组也可以是一个对象，对象的形式可以传入其他的配置如`options`，数组形式用于存放多个 `loader`。

``` js
module: {
    // 配置模块导入的规则
    rules: [ // 导入模块的规则
        {
            test: '/\.(jpg|png|gif)$/',
            use: [
                loader: `file-loader`,
                options:{
                    name:'[name].[ext]'
                }
            ]
        },
        {
            test: /\.less$/,
            use: [
                MiniCssExtractPlugin.loader, // 将 less 文件抽离到`main.css` 中
                'css-loader',
                'less-loader',
            ]
        }
    ]
}
```

### 7. loader 
* `loader`: Loader 就是一个打包的方案， webpack 不能直接识别非js文件结尾的文件，需要借助外部的帮助 `loader` 实现，`loader` 的特点是具备单一性，可以多个 `loader` 组合使用，`loader`的执行顺序是从右向左。`rules` 数组 `use` 中的 `loader` 可以是一个对象能传入额外的配置项 `options`。



## 配置 package.json 文件
* `"build": "webpack --config webpack.config.js"` 这一行脚本代码是运行 `webpack` 配置下的`webpack.config.js` 文件。
* `npm i webpack-dev-server -D ` 安装 `webpack` 的一个可以开启本地服务的包，`-D` 表示在开发环境 `development` 下安装的依赖
* `npx webpack-dev-server` 运行 `webpack` 提供的本地服务器，在`webpack.config.js`中可以配置服务信息


## webpack 常用插件
### 静态资源图片插件
* `file-loader`: 提供很多的占位符，直接看官网文档
* `url-loader`: 和`file-loader`相似，可以分类图片的打包大小



### html 插件
> 将打包后的js文件，放入到 `html` 文件中，这个插件主要是针对的是 `html` 文件。
* `npm i html-webpack-plugin` 将打包后的文件放入到 `html` 文件内
* `template: 打包后放入的模板路劲`。
* `filename`: 模板打包后的文件名。
* `minify`: 对象，最小化操作，将打包后 `html` 文件也压缩，`removeAttributeQuotes: true` 将 html 文件内的双引号去除。`collapseWhitespace: true, 将html文件的代码转换成一行`。
* `hash`: 哈希戳。防止打包后的文件发生覆盖。保证产生的是不同的缓存。也可以在打包的出口文件处加上`[hash:8]` 生成不同的打包文件。
> 最终的效果在 `html` 文件内有 `<script src=bundle8f33b531.js?8f33b5319c229ecfbf99></script>`

### CSS 样式的插件
> CSS文件引入到 `html` 模板文件内不会一起打包，因为 `html` 模板内的代码不会变化，也就不会将 CSS 文件打包，可以通过 `require()` 导入 css 文件结合 `webpack` 配置项 `module` 模块中的loader配置。 
* 插件：`css-loader` 用于解析 `@import` 语法
* 插件：`style-loader`: 把解析打包后的文件插入到 `head` 标签中。
* 插件：`less-loader`,将 less 语法转换成 css。
* 插件：`mini-css-extract-plugin`，将写入 `style` 标签内的 css 抽离成一个 `link` 导入 CSS 文件，`MiniCssExtractPlugin.loader` 可以将抽离文件都导入到一个文件内
* 插件：`postcss-loader`，用来给css样式做浏览器前缀 `webkit` 的配置
* 插件：`optimize-css-assets-webpack-plugin` 对CSS 代码进行压缩。

### JS 插件



